{% extends 'govuk/template.njk' %}

{% from "govuk/components/cookie-banner/macro.njk"  import govukCookieBanner %}
{% from 'govuk/components/footer/macro.njk'         import govukFooter %}
{% from 'govuk/components/header/macro.njk'         import govukHeader %}
{% from 'govuk/components/phase-banner/macro.njk'   import govukPhaseBanner %}

{% block head %}
  <!--[if !IE 8]><!-->
  <link href="//{{ cdn.host }}/stylesheets/govuk-frontend/v3.11.0/govuk-frontend-3.11.0.min.css" rel="stylesheet"/>
  <link href="//{{ cdn.host }}/stylesheets/services/dissolution/application.css" rel="stylesheet"/>

  <!--<![endif]-->

  <script src="https://code.jquery.com/jquery-1.12.4.min.js"
          integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
          crossorigin="anonymous"></script>

  {% block download %}{% endblock %}
{% endblock %}

{% block pageTitle %}
  {{ title }}
{% endblock %}

{% block header %}
  {% set html %}
    <p>We use some essential cookies to make our services work.</p>
    <p>We'd also like to use analytics cookies so we can understand how you use our services and to make improvements.</p>
  {% endset %}

  {% set acceptHtml %}
    <p>You've accepted analytics cookies. You can <a href="{{ chs.url }}/help/cookies">change your cookie settings</a> at any time.</p>
  {% endset %}

  {% set rejectHtml %}
    <p>You've rejected analytics cookies. You can <a href="{{ chs.url }}/help/cookies">change your cookie settings</a> at any time.</p>
  {% endset %}

  {{ govukCookieBanner({
    ariaLabel: "Cookies on Companies House services",
    attributes: {
      id: "cookie-banner"
    },
    hidden: true,
    messages: [
      {
        headingText: "Cookies on Companies House services",
        attributes: {
          id: "accept-or-reject-message"
        },
        hidden: true,
        html: html,
        actions: [
          {
            text: "Accept analytics cookies",
            type: "button",
            name: "cookies",
            value: "accept",
            attributes: {
              id: "accept-cookies-button"
            }
          },
          {
            text: "Reject analytics cookies",
            type: "button",
            name: "cookies",
            value: "reject",
            attributes: {
              id: "reject-cookies-button"
            }
          },
          {
            text: "View cookies",
            href: chs.url + "/help/cookies"
          }
        ]
      },
      {
        html: acceptHtml,
        role: "alert",
        attributes: {
          id: "accepted-cookies-message"
        },
        hidden: true,
        actions: [
          {
            text: "Hide this message",
            type: "button",
            name: "hide",
            value: "hide",
            attributes: {
              id: "hide-accepted-message-button"
            }
          }
        ]
      },
      {
        html: rejectHtml,
        role: "alert",
        attributes: {
          id: "rejected-cookies-message"
        },
        hidden: true,
        actions: [
          {
            text: "Hide this message",
            type: "button",
            name: "hide",
            value: "hide",
            attributes: {
              id: "hide-rejected-message-button"
            }
          }
        ]
      }
    ]
  }) }}
  {{
    govukHeader({
      homepageUrl: Paths.ROOT_URI,
      serviceName: serviceName,
      serviceUrl: Paths.ROOT_URI,
      containerClasses: 'govuk-width-container'
    })
  }}
{% endblock %}

{% block headIcons %}
  <link rel="shortcut icon" href="//{{ cdn.host }}/images/favicon.ico" type="image/x-icon" />
{% endblock %}

{% set mainClasses = mainClasses | default('govuk-main-wrapper--auto-spacing') %}

{% block beforeContent %}
  <div id="templateName" data-id="{{ title }}" hidden></div>

  {{
    govukPhaseBanner({
      tag: {
        text: 'Beta'
      },
      html: 'This is a new service â€“ your <a class="govuk-link" href="' + bannerFeedbackLink + '" target="_blank">feedback</a> will help us to improve it.'
    })
  }}

  {% include "components/sign-out-user-banner.njk" %}

  {% block backLink %}{% endblock %}
{% endblock %}

{% block footer %}
  {{
    govukFooter({
      meta: {
        items: [
          {
            href: 'http://resources.companieshouse.gov.uk/legal/termsAndConditions.shtml',
            text: 'Policies'
          },
          {
            href: 'https://www.gov.uk/help/cookies',
            text: 'Cookies'
          },
          {
            href: 'https://www.gov.uk/contact',
            text: 'Contact us'
          },
          {
            href: 'https://resources.companieshouse.gov.uk/accessibility/close-a-company-new.shtml',
            text: 'Accessibility statement',
            attributes: {
              'target' : '_blank'
            }
          },
          {
            href: 'https://developer.companieshouse.gov.uk/',
            text: 'Developers'
          }
        ]
      }
    })
  }}
{% endblock %}

{% block bodyEnd %}
  {# Run JavaScript at end of the <body>, to avoid blocking the initial render. #}
  <script src="//{{ cdn.host }}/javascripts/govuk-frontend/v3.11.0/govuk-frontend-3.11.0.min.js"></script>
  <script nonce={{ nonce | dump | safe }}>window.GOVUKFrontend.initAll()</script>
  <script src="//{{ cdn.host }}/javascripts/app/piwik-enable.js"></script>
  <script src="//{{ cdn.host }}/javascripts/app/cookie-consent-1.0.0.js"></script>
  <script nonce={{ nonce | dump | safe }} type="application/javascript">
    function startPiwik() {
      bindPiwikListener('dissolutions', '{{ piwik.url }}', {{ piwik.siteId }});
    };

    document.addEventListener('DOMContentLoaded', function () {
      var acceptButton = document.getElementById('accept-cookies-button')
      acceptButton.addEventListener('click', function() {CookieConsent.acceptCookies(startPiwik)})
      var rejectButton = document.getElementById('reject-cookies-button')
      rejectButton.addEventListener('click', CookieConsent.rejectCookies)
      var hideAcceptedButton = document.getElementById('hide-accepted-message-button')
      hideAcceptedButton.addEventListener('click', CookieConsent.hideCookieBanners)
      var hideRejectedButton = document.getElementById('hide-rejected-message-button')
      hideRejectedButton.addEventListener('click', CookieConsent.hideCookieBanners)
    })

    CookieConsent.start(startPiwik)
  </script>
  <noscript>
    <p>
      <img src="{{ piwik.url }}/piwik.php?idsite={{ piwik.siteId }}" style="border:0;" alt="" />
    </p>
  </noscript>
{% endblock %}
